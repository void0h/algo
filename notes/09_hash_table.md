# Hash Table 散列表

**散列表用的是数组支持按照下标随机访问数据的特性，所以散列表其实就是数组的一种扩展，由数组演化而来。可以说，如果没有数组，就没有散列表。**

散列函数设计的3点基本要求：

1. 散列函数计算得到的散列值是一个非负整数；
2. 如果 key1 = key2，那 hash(key1) == hash(key2)；
3. 如果 key1 ≠ key2，那 hash(key1) ≠ hash(key2)。（==散列冲突==）实际上无法完全避免。

## 散列冲突

再好的散列函数也无法避免散列冲突。常用的散列冲突解决方法有两类，==开放寻址法（open addressing）和链表法（chaining）==。

### 1. 开放寻址法

开放寻址法的核心思想是，如果出现了散列冲突，我们就==重新探测==一个空闲位置，将其插入。

==线性探测（Linear Probing）：== 从当前位置开始，依次往后查找，看是否有空闲位置，直到找到为止。==效果较差，不可取==。

==二次探测（Quadratic probing）：== 跟线性探测很像，二次探测探测的步长就变成了原来的“二次方”，也就是说，它探测的下标序列就是 hash(key)+0，hash(key)+12，hash(key)+22……

==双重散列（Double hashing）：== 使用一组散列函数 hash1(key)，hash2(key)，hash3(key)……我们先用第一个散列函数，如果计算得到的存储位置已经被占用，再用第二个散列函数，依次类推，直到找到空闲的存储位置。

**不管采用哪种探测方法，当散列表中==空闲位置不多==的时候，散列==冲突==的概率就会大大==提高==。**

#### 装载因子（load factor）

装载因子的计算公式是：
```散列表的装载因子=填入表中的元素个数/散列表的长度```

**装载因子越大，说明空闲位置越少，冲突越多，散列表的性能会下降。**

### 2. 链表法

<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" 
    src="https://raw.githubusercontent.com/hongguangli/Figures/main/20230129221825.png" width=500>
</center>

## 如何设计散列函数？

1. 散列函数的设计不能太复杂。
2. 散列函数生成的值要尽可能随机并且均匀分布。
   
## 装载因子过大了怎么办？

当装载因子过大时，我们也可以进行动态扩容，重新申请一个更大的散列表，将数据搬移到这个新散列表中。

## 如何避免低效的扩容？
当装载因子触达阈值之后，我们==只申请新空间==，但并不将老的数据搬移到新散列表中。当有==新数据要插入==时，我们将新数据插入新散列表中，并且从老的散列表中拿出一个数据放入到新散列表。

## 如何选择冲突解决方法？

1. ==开放寻址法==
    ==优点==：散列表中的数据都存储在数组中，可以有效地利用 CPU 缓存加快查询速度。
    ==缺点==：删除数据的时候比较麻烦，需要特殊标记已经删除掉的数据。而且，在开放寻址法中，所有的数据都存储在一个数组中，比起链表法来说，冲突的代价更高。所以，使用开放寻址法解决冲突的散列表，装载因子的上限不能太大。这也导致这种方法比链表法更浪费内存空间。
    **当数据量比较小、装载因子小的时候，适合采用开放寻址法。这也是 Java 中的ThreadLocalMap使用开放寻址法解决散列冲突的原因。**
2. ==链表法==
   ==优点==：链表法对内存的利用率比开放寻址法要高。对大装载因子的容忍度更高。
   ==缺点==：链表因为要存储指针，所以对于比较小的对象的存储，是比较消耗内存的，还有可能会让内存的消耗翻倍。

    **基于链表的散列冲突处理方法比较适合存储大对象、大数据量的散列表，而且，比起开放寻址法，它更加灵活，支持更多的优化策略，比如用==红黑树代替链表==。**

<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" 
    src="https://raw.githubusercontent.com/hongguangli/Figures/main/20230129234355.png" width=500>
</center>
